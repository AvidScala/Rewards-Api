:spring_version: current

:spring_data_rest: current
:spring_data_jpa: current
:spring_data_commons: current
:spring_boot_version: 2.4.3.RELEASE
:Controller: https://docs.spring.io/spring/docs/{spring_version}/javadoc-api/org/springframework/stereotype/Controller.html
:DispatcherServlet: https://docs.spring.io/spring/docs/{spring_version}/javadoc-api/org/springframework/web/servlet/DispatcherServlet.html
:SpringApplication: https://docs.spring.io/spring-boot/docs/{spring_boot_version}/api/org/springframework/boot/SpringApplication.html
:ResponseBody: https://docs.spring.io/spring/docs/{spring_version}/javadoc-api/org/springframework/web/bind/annotation/ResponseBody.html
:toc:
:icons: font
:source-highlighter: prettify
:project_id: rewards

This guide walks you through the process details of the Rewards-API.

== What does API do?

This api will accept customer Info (Phone Number, First and last name, City)
and creates a customer entry in the system.

Each customer is identified by a unique customerId which is autogenerated by JPA persistance.

Each customer gets reward points based on the following algorithm

== Technologies used

: java_version: 1.8

: Spring boot

: Spring JPA

: Spring Rest

: Maven

== Assumptions made

This API only accepts whole amounts of transaction value.

The customer can have only one Phone number and the phone numbers are numbers in the
following format: 9999999999

User can ask for reward points only upto 12 months

== DB schema

This has 3 SQL tables with the following schema.

CUSTOMER 

---------------------------------------------------------
customerId |  PhoneNumber | FirstName | LastName | City
---------------------------------------------------------


Transaction 

--------------------------------------------------------------------------------------------------------
transactiond |  CustomerId | rewardPoints | txnAmount | totalPointsToDate | redeemedPoints | createdOn 
--------------------------------------------------------------------------------------------------------

Monthly Transaction 

------------------------------------------------------------------
transactiond |  customerId | monthYear | totalPoints | createdOn
------------------------------------------------------------------

== Future Scope

This API can be extended to accept the redeemed points for any transaction.

The DB schema is handled to have a column for redeemed points.

== Running it locally

cd to initial folder 

run mvnw spring-boot:run


== Test the Api

You can use Postman/  any REST client you
wish.

POST  http://localhost:8080/customer for creating a customer with the following body

```json

{
 "phoneNumber" : "9999999999",
 "firstName" : "firstName",
 "lastName": "LastName",
 "city": "City"
}
```


Getting all the customers

GET http://localhost:8080/customers

Getting a customer by phoneNumber

GET http://localhost:8080/customers/phoneNumber/{phoneNumber}

Getting a customer by customerId

GET http://localhost:8080/customers/Id/{Id}

For writing a transaction:

POST http://localhost:8080/transaction/?customerId=1&txnAmount=xxx

For getting the rewards:

GET http://localhost:8080/rewardPoints/{customerId}/{?numofMonths}

numOfmonths by default is set to 3 months.

User can provide any value to override this (max of 12 months)

The following is the output format


```json
{
    "rewardsTxnMonthlyList": [
        {
            "monthlyTxnId": 1,
            "monthyear": 72021,
            "pointsPerMonth": 204,
            "customerId": 1,
            "createdOn": "2021-07-05T09:58:46.049+00:00"
        }
    ],
    "totalPoints": 204
}

```
